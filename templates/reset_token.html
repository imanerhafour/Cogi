{% extends 'base.html' %}

{% block title %}RÃ©initialiser le mot de passe{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center">ğŸ” Nouveau mot de passe</h2>
  <p class="text-muted text-center">CrÃ©e un mot de passe fort pour sÃ©curiser ton compte.</p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="alert alert-danger" role="alert">
        {% for category, message in messages %}
          <p class="mb-0">{{ message }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" class="needs-validation" novalidate>
    <div class="mb-3">
      <label for="password" class="form-label">Nouveau mot de passe</label>
      <input type="password" id="password" name="password" class="form-control" required
             onkeyup="checkPasswordStrength()"
             pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}"
             title="Minimum 8 caractÃ¨res, une majuscule, une minuscule, un chiffre et un caractÃ¨re spÃ©cial.">
      <ul class="list-unstyled mt-2">
        <li id="length" class="text-danger">âŒ Minimum 8 caractÃ¨res</li>
        <li id="uppercase" class="text-danger">âŒ Une majuscule</li>
        <li id="lowercase" class="text-danger">âŒ Une minuscule</li>
        <li id="digit" class="text-danger">âŒ Un chiffre</li>
        <li id="special" class="text-danger">âŒ Un caractÃ¨re spÃ©cial</li>
      </ul>
    </div>

    <div class="mb-3">
      <label for="confirm" class="form-label">Confirmer le mot de passe</label>
      <input type="password" id="confirm" name="confirm" class="form-control" required>
    </div>

    <div class="d-grid">
      <button type="submit" class="btn btn-success">ğŸ” RÃ©initialiser</button>
    </div>
  </form>
</div>

<!-- JS de validation -->
<script>
  function checkPasswordStrength() {
    const password = document.getElementById('password').value;
    const length = document.getElementById('length');
    const uppercase = document.getElementById('uppercase');
    const lowercase = document.getElementById('lowercase');
    const digit = document.getElementById('digit');
    const special = document.getElementById('special');

    length.className = password.length >= 8 ? 'text-success' : 'text-danger';
    length.textContent = password.length >= 8 ? 'âœ… Minimum 8 caractÃ¨res' : 'âŒ Minimum 8 caractÃ¨res';

    uppercase.className = /[A-Z]/.test(password) ? 'text-success' : 'text-danger';
    uppercase.textContent = /[A-Z]/.test(password) ? 'âœ… Une majuscule' : 'âŒ Une majuscule';

    lowercase.className = /[a-z]/.test(password) ? 'text-success' : 'text-danger';
    lowercase.textContent = /[a-z]/.test(password) ? 'âœ… Une minuscule' : 'âŒ Une minuscule';

    digit.className = /[0-9]/.test(password) ? 'text-success' : 'text-danger';
    digit.textContent = /[0-9]/.test(password) ? 'âœ… Un chiffre' : 'âŒ Un chiffre';

    special.className = /[\\W_]/.test(password) ? 'text-success' : 'text-danger';
    special.textContent = /[\\W_]/.test(password) ? 'âœ… Un caractÃ¨re spÃ©cial' : 'âŒ Un caractÃ¨re spÃ©cial';
  }

  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });
  });
</script>
{% endblock %}
