{% extends 'base.html' %}

{% block title %}Reset your password{% endblock %}

{% block content %}
<div class="container mt-5">
  <h2 class="text-center">ğŸ” Create a new password</h2>
  <p class="text-muted text-center">Choose a strong password to secure your account.</p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="alert alert-danger" role="alert">
        {% for category, message in messages %}
          <p class="mb-0">{{ message }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="POST" class="needs-validation" novalidate>
    <div class="mb-3">
      <label for="password" class="form-label">New password</label>
      <input type="password" id="password" name="password" class="form-control" required
             onkeyup="checkPasswordStrength()"
             pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*(),.?&quot;:{}|&lt;&gt;]).{8,}">
      <ul class="list-unstyled mt-2">
        <li id="length" class="text-danger">âŒ At least 8 characters</li>
        <li id="uppercase" class="text-danger">âŒ One uppercase letter</li>
        <li id="lowercase" class="text-danger">âŒ One lowercase letter</li>
        <li id="digit" class="text-danger">âŒ One digit</li>
        <li id="special" class="text-danger">âŒ One special character</li>
      </ul>
    </div>

    <div class="mb-3">
      <label for="confirm" class="form-label">Confirm password</label>
      <input type="password" id="confirm" name="confirm" class="form-control" required>
    </div>

    <!-- âœ… Show password checkbox -->
    <div class="form-check mt-2 mb-3">
      <input class="form-check-input" type="checkbox" id="showPassword" onclick="togglePasswordVisibility()">
      <label class="form-check-label" for="showPassword">Show password</label>
    </div>

    <div class="d-grid">
      <button type="submit" class="btn btn-success">ğŸ” Reset password</button>
    </div>
  </form>
</div>

<!-- âœ… Scripts -->
<script>
  function checkPasswordStrength() {
    const password = document.getElementById('password').value;

    const length = document.getElementById('length');
    const uppercase = document.getElementById('uppercase');
    const lowercase = document.getElementById('lowercase');
    const digit = document.getElementById('digit');
    const special = document.getElementById('special');

    length.className = password.length >= 8 ? 'text-success' : 'text-danger';
    length.textContent = password.length >= 8 ? 'âœ… At least 8 characters' : 'âŒ At least 8 characters';

    uppercase.className = /[A-Z]/.test(password) ? 'text-success' : 'text-danger';
    uppercase.textContent = /[A-Z]/.test(password) ? 'âœ… One uppercase letter' : 'âŒ One uppercase letter';

    lowercase.className = /[a-z]/.test(password) ? 'text-success' : 'text-danger';
    lowercase.textContent = /[a-z]/.test(password) ? 'âœ… One lowercase letter' : 'âŒ One lowercase letter';

    digit.className = /[0-9]/.test(password) ? 'text-success' : 'text-danger';
    digit.textContent = /[0-9]/.test(password) ? 'âœ… One digit' : 'âŒ One digit';

    special.className = /[!@#$%^&*(),.?":{}|<>]/.test(password) ? 'text-success' : 'text-danger';
    special.textContent = /[!@#$%^&*(),.?":{}|<>]/.test(password)
      ? 'âœ… One special character'
      : 'âŒ One special character';
  }

  function togglePasswordVisibility() {
    const pwd = document.getElementById("password");
    const confirm = document.getElementById("confirm");
    if (pwd) pwd.type = pwd.type === "password" ? "text" : "password";
    if (confirm) confirm.type = confirm.type === "password" ? "text" : "password";
  }

  document.addEventListener('DOMContentLoaded', function () {
    const form = document.querySelector('form');
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });
  });
</script>
{% endblock %}
