{% extends 'base.html' %}

{% block title %}Chat with Cogi{% endblock %}

{% block content %}
<div class="chat-container">

  <!-- Zone d'affichage des messages -->
  <div id="chat-box" class="chat-box">
    <!-- Message de bienvenue -->
    <div class="chat-message bot-message fade-in">
      <div class="message-avatar">
        <i class="bi bi-robot"></i>
      </div>
      <div class="message-content">
        <div class="message-sender">Cogi</div>
        <div class="message-text">
          Hello {{ first_name }} {{ last_name }}! How can I help you today? I'm here to talk about whatever is on your mind.
        </div>
      </div>
    </div>

    <!-- Historique des messages -->
    {% if history %}
      {% for msg in history %}
        <div class="chat-message {% if msg[1] == 'user' %}user-message{% else %}bot-message{% endif %} fade-in">
          <div class="message-avatar">
            {% if msg[1] == 'user' %}
              <i class="bi bi-person-circle"></i>
            {% else %}
              <i class="bi bi-robot"></i>
            {% endif %}
          </div>
          <div class="message-content">
            <div class="message-sender">{{ msg[1] | capitalize }}</div>
            <div class="message-text">{{ msg[0] }}</div>
            <div class="message-time">{{ msg[2] }}</div>
          </div>
        </div>
      {% endfor %}
    {% endif %}
  </div>

  <!-- Champ de saisie utilisateur -->
  <div class="chat-input glass-card">
    <form method="POST" action="/chat" id="message-form" class="input-group">
      <input type="text" id="user-input" name="message" class="form-control" placeholder="Type your message here..." autocomplete="off" required>
      <button type="button" id="micBtn" class="btn btn-mic">
        <i class="bi bi-mic"></i>
      </button>
      <div id="voice-status" class="voice-status">Micro: inactif</div>
      <button type="submit" id="send-btn" class="btn btn-love">
        <i class="bi bi-send-fill"></i> Send
      </button>
    </form>

    <!-- Suggestions -->
    <div class="chat-suggestions mt-3">
      <span class="tag tag-love suggestionBtn">I feel anxious</span>
      <span class="tag tag-peace suggestionBtn">Breathing techniques</span>
      <span class="tag tag-harmony suggestionBtn">How can I improve my mood?</span>
    </div>
  </div>
</div>
{% endblock %}
