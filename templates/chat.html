{% extends 'base.html' %}

{% block title %}Chat with Cogi{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
  <div class="row">
    <!-- Sidebar historique -->
  <!-- Sidebar historique -->
<div class="col-md-3">
  <div class="list-group">
    <h5 class="mb-3">ðŸ•˜ Chat History</h5>
    {% for convo in sessions %}
      <a href="{{ url_for('chat', session_id=convo.id) }}" class="list-group-item list-group-item-action {% if convo.id == active_id %}active{% endif %}">
        {{ convo.timestamp.strftime('%d/%m %H:%M') }}
      </a>
    {% endfor %}
    <a href="{{ url_for('chat', new='1') }}" class="btn btn-sm btn-outline-success mt-3">âž• New Chat</a>
  </div>
</div>



    <!-- Chat principal -->
    <div class="col-md-9">
      <div class="chat-container">

        <!-- Zone d'affichage des messages -->
        <div id="chat-box" class="chat-box">
          <!-- Message de bienvenue -->
          <div class="chat-message bot-message fade-in">
            <div class="message-avatar">
              <i class="bi bi-robot"></i>
            </div>
            <div class="message-content">
              <div class="message-sender">Cogi</div>
              <div class="message-text">
                Hello {{ first_name }} {{ last_name }}! How can I help you today? I'm here to talk about whatever is on your mind.
              </div>
            </div>
          </div>

          <!-- Historique des messages -->
          {% if history %}
            {% for msg in history %}
              <div class="chat-message {% if msg[1] == 'user' %}user-message{% else %}bot-message{% endif %} fade-in">
                <div class="message-avatar">
                  {% if msg[1] == 'user' %}
                    <i class="bi bi-person-circle"></i>
                  {% else %}
                    <i class="bi bi-robot"></i>
                  {% endif %}
                </div>
                <div class="message-content">
                  <div class="message-sender">{{ msg[1] | capitalize }}</div>
                  <div class="message-text">{{ msg[0] }}</div>
                  <div class="message-time">{{ msg[2] }}</div>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>

        <!-- Champ de saisie utilisateur -->
        <div class="chat-input glass-card">
          <form method="POST" action="/chat" id="message-form" class="input-group">
            <input type="text" id="user-input" name="message" class="form-control" placeholder="Type your message here..." autocomplete="off" required>
            <button type="button" id="micBtn" class="btn btn-mic">
              <i class="bi bi-mic"></i>
            </button>
            <div id="voice-status" class="voice-status">Micro: inactif</div>
            <button type="submit" id="send-btn" class="btn btn-love">
              <i class="bi bi-send-fill"></i> Send
            </button>
          </form>

          <!-- Suggestions -->
          <div class="chat-suggestions mt-3">
            <span class="tag tag-love suggestionBtn">I feel anxious</span>
            <span class="tag tag-peace suggestionBtn">Breathing techniques</span>
            <span class="tag tag-harmony suggestionBtn">How can I improve my mood?</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .message.user { text-align: right; color: #444; }
  .message.bot { text-align: left; color: #5c5c5c; }
  .timestamp { font-size: 0.8em; color: #888; }
  .chat-box { height: 400px; overflow-y: auto; background: #f9f9f9; border-radius: 10px; }
</style>

<style>
  .list-group-item.active {
    background-color: #9a51e0;
    border-color: #9a51e0;
    color: white;
  }
</style>

{% endblock %}
